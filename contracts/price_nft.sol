// SPDX-License-Identifier: MIT
pragma solidity 0.8.11;

import "@openzeppelin/contracts/token/ERC721/ERC721.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol";
import "base64-sol/base64.sol";
import "hardhat/console.sol";

library SwordMaker {
    function generateSVGFromPrice(int256 value_pct_change) 
        external
        view
        returns (string memory) 
    {
        string memory sword1 = '<svg width="350" height="350" viewBox="0 0 350 350" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="Frame 1"><g id="price_sword" clip-path="url(#clip0_1_3)"><path id="BladeBase" d="M136.639 251.991C137.209 251.441 137.614 250.738 137.81 249.969L145.622 218.971C145.973 217.553 145.575 216.054 144.566 215C143.557 213.946 142.07 213.487 140.642 213.787L109.352 220.331C108.573 220.495 107.857 220.872 107.287 221.422L68.6357 255.647C66.9481 257.271 66.8937 259.952 68.5142 261.643L91.9951 286.098C92.7734 286.908 93.8444 287.377 94.9674 287.4C96.0907 287.422 95.6892 286.876 96.4997 286.098L94.9674 287.4L136.639 251.991Z" fill="#CCD1D9"/><path id="BladeEdge" opacity="0.2" d="M144.444 215.122C143.434 214.067 141.948 213.609 140.519 213.909L109.23 220.453C108.451 220.617 107.735 220.994 107.165 221.544L68.6357 255.647C66.948 257.271 66.8937 259.952 68.5142 261.643L91.995 286.098C92.7734 286.908 93.8444 287.377 94.9673 287.4C96.0907 287.422 97.1766 286.997 97.9872 286.219L136.517 252.113C137.087 251.563 137.492 250.86 137.688 250.091L145.5 219.093C145.851 217.674 145.453 216.176 144.444 215.122ZM141.385 218.056L133.58 249.055L95.0532 283.161L71.5696 258.705L110.096 224.603L141.385 218.056Z" fill="white"/><path id="BladeFuller" d="M80.2529 273.87C78.6324 272.179 78.6867 269.498 80.3743 267.874L101.5 249C103.191 247.38 105.872 247.434 107.489 249.121C109.113 250.809 109.059 253.493 107.368 255.114L86.2454 273.991C84.5579 275.609 81.8766 275.555 80.2529 273.87Z" fill="#AAB2BC"/><g id="Hilt"><g id="HandleDeco"><path id="Handle" d="M84.2492 285.94C84.272 284.817 83.847 283.728 83.0686 282.918L71.3268 270.69C69.7063 269 67.0219 268.945 65.3343 270.568L26.4448 307.917C24.7573 309.534 24.703 312.216 26.3234 313.906L38.0653 326.134C39.6859 327.818 42.3699 327.872 44.0574 326.255L82.9469 288.907C83.7578 288.129 84.2265 287.064 84.2492 285.94Z" fill="#ED5564"/><path id="Stripe1" d="M42.6711 292.332L78.6222 293.06L82.9473 288.907C83.7578 288.128 84.2265 287.064 84.2492 285.94C84.2579 285.512 84.2012 285.095 84.0881 284.695L51.3175 284.031L42.6711 292.332Z" fill="#DA4453"/><path id="Stripe2" d="M68.9309 302.37L32.9766 301.641L26.4448 307.917C25.8434 308.494 25.453 309.207 25.2673 309.961L60.2845 310.67L68.9309 302.37Z" fill="#DA4453"/></g><path id="CrossGuard" d="M112.785 295.509L59.9487 240.489C58.3282 238.801 55.6469 238.747 53.9594 240.367L44.7874 249.172C43.0997 250.796 43.0454 253.477 44.666 255.161L97.5017 310.183C98.28 310.993 99.3478 311.462 100.471 311.485C101.598 311.508 102.684 311.082 103.494 310.304L112.663 301.499C114.351 299.881 114.405 297.194 112.785 295.509Z" fill="#FFCE54"/><path id="Pommel" d="M45.2373 324.112C45.329 319.587 43.6524 315.295 40.518 312.027C34.0421 305.283 23.2925 305.065 16.5487 311.541C13.2842 314.679 11.4355 318.901 11.3438 323.425C11.2522 327.95 12.9288 332.243 16.0631 335.511C19.2007 338.778 23.4196 340.627 27.9472 340.719C32.4747 340.81 36.7651 339.134 40.0324 335.996C43.2969 332.859 45.1457 328.636 45.2373 324.112Z" fill="#FFCE54"/><path id="HiltDetail" d="M28.2047 328.006C30.5442 328.053 32.4791 326.194 32.5266 323.853C32.574 321.512 30.7159 319.575 28.3765 319.528C26.037 319.481 24.102 321.34 24.0546 323.681C24.0072 326.022 25.8652 327.958 28.2047 328.006Z" fill="#F6BB42"/></g></g></g><defs><clipPath id="clip0_1_3"><rect width="203.417" height="203.417" fill="white" transform="translate(15.1204 137) rotate(1.16066)"/></clipPath></defs></svg>'; 
        string memory sword2 = '<svg width="350" height="350" viewBox="0 0 350 350" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="Frame 1"><g id="sword-svgrepo-com 1" clip-path="url(#clip0_1_3)"><path id="BladeBase" d="M209.302 179.328C209.872 178.778 210.277 178.075 210.473 177.306L218.285 146.308C218.636 144.89 218.238 143.391 217.229 142.337C216.22 141.283 214.733 140.824 213.305 141.124L182.015 147.668C181.236 147.832 180.52 148.209 179.95 148.759L68.6357 255.647C66.948 257.271 66.8937 259.952 68.5142 261.643L91.9951 286.098C92.7734 286.908 93.8444 287.377 94.9674 287.4C96.0907 287.422 97.1766 286.997 97.9872 286.219L209.302 179.328Z" fill="#CCD1D9"/><path id="BladeEdge" opacity="0.2" d="M217.229 142.337C216.219 141.283 214.733 140.824 213.304 141.124L182.015 147.668C181.235 147.832 180.52 148.209 179.95 148.759L68.6357 255.647C66.948 257.271 66.8937 259.952 68.5142 261.643L91.9951 286.098C92.7734 286.908 93.8444 287.377 94.9674 287.4C96.0907 287.422 97.1766 286.997 97.9872 286.219L209.302 179.328C209.872 178.778 210.277 178.075 210.473 177.306L218.285 146.308C218.636 144.889 218.238 143.391 217.229 142.337ZM214.17 145.271L206.365 176.27L95.0532 283.161L71.5696 258.705L182.881 151.818L214.17 145.271Z" fill="white"/><path id="BladeFuller" d="M80.2529 273.87C78.6324 272.179 78.6867 269.498 80.3743 267.874L158.688 192.676C160.379 191.056 163.06 191.11 164.677 192.798C166.301 194.485 166.247 197.17 164.556 198.79L86.2454 273.991C84.5579 275.609 81.8766 275.555 80.2529 273.87Z" fill="#AAB2BC"/><g id="Hilt"><g id="HandleDeco"><path id="Handle" d="M84.2492 285.94C84.272 284.817 83.847 283.728 83.0686 282.918L71.3268 270.69C69.7063 269 67.0219 268.945 65.3343 270.568L26.4448 307.917C24.7573 309.534 24.703 312.216 26.3234 313.906L38.0653 326.134C39.6859 327.818 42.3699 327.872 44.0574 326.255L82.9469 288.907C83.7578 288.129 84.2265 287.064 84.2492 285.94Z" fill="#ED5564"/><path id="Vector" d="M42.6711 292.332L78.6222 293.06L82.9473 288.907C83.7578 288.128 84.2265 287.064 84.2492 285.94C84.2579 285.512 84.2012 285.095 84.0881 284.695L51.3175 284.031L42.6711 292.332Z" fill="#DA4453"/><path id="Vector_2" d="M68.9309 302.37L32.9766 301.641L26.4448 307.917C25.8434 308.494 25.453 309.207 25.2673 309.961L60.2845 310.67L68.9309 302.37Z" fill="#DA4453"/></g><path id="CrossGuard" d="M112.785 295.509L59.9487 240.489C58.3282 238.801 55.6469 238.747 53.9594 240.367L44.7874 249.172C43.0997 250.796 43.0454 253.477 44.666 255.161L97.5017 310.183C98.28 310.993 99.3478 311.462 100.471 311.485C101.598 311.508 102.684 311.082 103.494 310.304L112.663 301.499C114.351 299.881 114.405 297.194 112.785 295.509Z" fill="#FFCE54"/><path id="Pommel" d="M45.2373 324.112C45.329 319.587 43.6524 315.295 40.518 312.027C34.0421 305.283 23.2925 305.065 16.5487 311.541C13.2842 314.679 11.4355 318.901 11.3438 323.425C11.2522 327.95 12.9288 332.243 16.0631 335.511C19.2007 338.778 23.4196 340.627 27.9472 340.719C32.4747 340.81 36.7651 339.134 40.0324 335.996C43.2969 332.859 45.1457 328.636 45.2373 324.112Z" fill="#FFCE54"/><path id="Vector_3" d="M28.2047 328.006C30.5442 328.053 32.4791 326.194 32.5266 323.853C32.574 321.512 30.7159 319.575 28.3765 319.528C26.037 319.481 24.102 321.34 24.0546 323.681C24.0072 326.022 25.8652 327.958 28.2047 328.006Z" fill="#F6BB42"/></g></g></g><defs><clipPath id="clip0_1_3"><rect width="203.417" height="203.417" fill="white" transform="translate(15.1204 137) rotate(1.16066)"/></clipPath></defs></svg>';
        string memory sword3 = '<svg width="350" height="350" viewBox="0 0 350 350" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="price_sword"><path id="BladeBase" d="M315.786 72.8438C316.356 72.2934 316.762 71.5907 316.958 70.8217L324.77 39.8229C325.121 38.405 324.723 36.9067 323.714 35.8523C322.705 34.7978 321.218 34.3393 319.789 34.6394L288.5 41.1831C287.721 41.3473 287.005 41.7243 286.435 42.2746L68.6356 255.647C66.948 257.271 66.8937 259.952 68.5141 261.643L91.995 286.098C92.7734 286.908 93.8444 287.377 94.9673 287.4C96.0907 287.422 97.1766 286.997 97.9871 286.219L153.644 232.774L315.786 72.8438Z" fill="#CCD1D9"/><path id="BladeEdge" opacity="0.2" d="M323.444 36.0085C322.434 34.9541 320.948 34.4956 319.519 34.7957L303.875 38.0675L288.23 41.3393C287.451 41.5036 286.735 41.8805 286.165 42.4308L68.6356 255.647C66.948 257.271 66.8936 259.952 68.5141 261.643L91.995 286.098C92.7733 286.908 93.8443 287.377 94.9673 287.4C96.0906 287.422 97.1765 286.997 97.9871 286.219L315.517 73C316.087 72.4496 316.492 71.7469 316.688 70.978L324.5 39.9792C324.851 38.5608 324.453 37.0626 323.444 36.0085ZM320.385 38.9425L312.58 69.9414L95.0532 283.161L71.5695 258.705L289.096 45.4893L320.385 38.9425Z" fill="white"/><path id="BladeFuller" d="M80.2529 273.87C78.6324 272.179 78.6867 269.498 80.3743 267.874L196.511 154.854C198.201 153.233 200.883 153.288 202.5 154.975C204.124 156.663 204.069 159.347 202.379 160.968L86.2454 273.991C84.5579 275.609 81.8766 275.555 80.2529 273.87Z" fill="#AAB2BC"/><g id="Hilt"><g id="HandleDeco"><path id="Handle" d="M84.2492 285.94C84.272 284.817 83.847 283.728 83.0686 282.918L71.3268 270.69C69.7063 269 67.0219 268.945 65.3343 270.568L26.4448 307.917C24.7573 309.534 24.703 312.216 26.3234 313.906L38.0653 326.134C39.6859 327.818 42.3699 327.872 44.0574 326.255L82.9469 288.907C83.7578 288.129 84.2265 287.064 84.2492 285.94Z" fill="#ED5564"/><path id="Stripe1" d="M42.6711 292.332L78.6222 293.06L82.9473 288.907C83.7578 288.128 84.2265 287.064 84.2492 285.94C84.2579 285.512 84.2012 285.095 84.0881 284.695L51.3175 284.031L42.6711 292.332Z" fill="#DA4453"/><path id="Stripe2" d="M68.9309 302.37L32.9766 301.641L26.4448 307.917C25.8434 308.494 25.453 309.207 25.2673 309.961L60.2845 310.67L68.9309 302.37Z" fill="#DA4453"/></g><path id="CrossGuard" d="M112.785 295.509L59.9487 240.489C58.3282 238.801 55.6469 238.747 53.9594 240.367L44.7874 249.172C43.0997 250.796 43.0454 253.477 44.666 255.161L97.5017 310.183C98.28 310.993 99.3478 311.462 100.471 311.485C101.598 311.508 102.684 311.082 103.494 310.304L112.663 301.499C114.351 299.881 114.405 297.194 112.785 295.509Z" fill="#FFCE54"/><path id="Pommel" d="M45.2373 324.112C45.329 319.587 43.6524 315.295 40.518 312.027C34.0421 305.283 23.2925 305.065 16.5487 311.541C13.2842 314.679 11.4355 318.901 11.3438 323.425C11.2522 327.95 12.9288 332.243 16.0631 335.511C19.2007 338.778 23.4196 340.627 27.9472 340.719C32.4747 340.81 36.7651 339.134 40.0324 335.996C43.2969 332.859 45.1457 328.636 45.2373 324.112Z" fill="#FFCE54"/><path id="HiltDetail" d="M28.2047 328.006C30.5442 328.053 32.4791 326.194 32.5266 323.853C32.574 321.512 30.7159 319.575 28.3765 319.528C26.037 319.481 24.102 321.34 24.0546 323.681C24.0072 326.022 25.8652 327.958 28.2047 328.006Z" fill="#F6BB42"/></g></g></svg>';
        string memory sword4 = '<svg width="350" height="350" viewBox="0 0 350 350" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="price_sword" clip-path="url(#clip0_1_3)"><g id="Flame"><path id="RedFlame" d="M47.7706 226.855C53.8773 251.36 58.7885 264.032 74.0941 281.932C80.1197 287.927 84.7004 290.586 95.2061 293.955C100.559 296.497 104.956 297.844 118.747 299.916C133.671 306.768 140.215 305.563 150.682 300.082C139.837 291.79 154.164 281.524 145.376 278.679C136.588 275.833 149.937 259.669 165.256 263.702C168.229 273.729 172.32 276.696 182.195 279.163C191.487 280.999 198.009 280.558 212.387 276.703C229.171 268.196 233.534 259.909 241.247 245.082C229.749 255.096 223.617 258.154 213.61 256.084C203.007 253.901 199.115 250.765 201.358 236.621C207.019 228.463 212.427 230.163 224.16 226.381C235.892 222.598 258.59 206.215 274.276 186.214C280.69 176.612 279.861 173.175 278.273 167.092C269.202 179.626 263.112 184.09 250.515 187.298C238.426 190.086 233.777 188.197 229.036 179.079C216.984 170.313 268.849 149.125 276.575 141.736C284.301 134.346 286.328 120.39 294.416 117.653C302.504 114.915 300.426 95.1918 300.426 95.1918C291.347 107.969 285.503 113.208 273.331 118.074C263.844 123.181 260.619 121.309 256.884 113.413C254.323 109.376 255.523 106.722 262.822 101.237C276.97 89.5209 285.424 84.6622 296.836 63.9696C301.389 50.8049 304.355 36.0035 319.557 16.3949C307.404 18.9857 300.595 22.8031 288.46 34.5893C280.847 42.3589 276.882 48.595 270.252 62.4771C262.274 75.5813 256.952 78.7787 246.052 77.6511C238.049 70.6797 237.061 64.23 245.654 45.2011L227.983 61.1593C220.851 74.7517 220.609 79.9513 222.171 87.9403C214.736 102.401 209.723 105.759 199.714 105.74C186.246 91.1551 186.68 81.9051 196.197 64.2334C189.743 66.0674 186.675 64.8266 175.999 84.095C178.178 102.955 176.302 113.702 165.256 133.288C155.621 136.917 151.189 136.737 146.649 128.725C145.043 108.635 148.175 96.9442 165.835 74.8183C148.483 78.9776 140.152 85.3024 127.008 101.483C116.754 119.835 115.332 129.494 125.739 144.831C108.636 163.168 121.036 171.596 113.227 178.953C113.227 178.953 106.061 187.938 96.5109 180.257C86.961 172.576 92.4042 131.483 101.064 114.03C98.8909 111.423 63.3908 147.232 57.9707 165.782C52.5506 184.332 69.2917 199.674 64.2891 221.231C61.1387 230.085 57.3969 231.065 47.7706 226.855Z" fill="#E8522A" stroke="#5E5E5E" stroke-opacity="0.7"/><path id="OrangeFlame" d="M129.659 292.266C109.311 289.104 98.6574 286.046 82.9783 274.935C77.6588 270.484 75.1565 266.961 71.6313 258.681C69.1661 254.522 67.742 251.052 65.0226 240.012C58.3383 228.401 58.824 223.002 62.4851 214.106C70.031 222.3 77.2843 209.921 80.2552 216.845C83.226 223.769 95.3397 211.751 90.9145 199.614C82.5523 197.934 79.8367 194.831 77.0918 186.998C74.9025 179.591 74.77 174.266 76.8168 162.314C82.4578 148.069 88.8551 143.922 100.309 136.576C93.0461 146.641 91.0257 151.841 93.4591 159.811C96.0281 168.257 98.8659 171.186 110.177 168.33C116.372 163.138 114.585 158.873 116.772 149.075C118.959 139.276 130.548 119.654 145.601 105.459C152.911 99.5507 155.763 99.9717 160.819 100.815C151.329 109.095 148.164 114.364 146.508 124.823C145.155 134.839 147.038 138.473 154.795 141.654C162.816 150.793 176.11 107.148 181.526 100.336C186.942 93.5248 198.116 90.8583 199.729 84.0935C201.342 77.3287 217.506 77.5714 217.506 77.5714C207.819 85.8752 204.007 91.0017 200.974 101.237C197.543 109.31 199.305 111.79 205.994 114.244C209.463 116.026 211.527 114.858 215.429 108.533C223.874 96.1924 227.181 88.9757 243.116 78.1984C253.458 73.5396 265.248 70.048 280.018 56.2744C278.83 66.3279 276.244 72.133 267.591 82.8447C261.858 89.5927 257.096 93.2675 246.328 99.6645C236.293 107.099 234.098 111.653 235.833 120.416C242.094 126.401 247.402 126.73 262.2 118.363L250.578 133.873C240.083 140.657 235.881 141.234 229.28 140.552C218.103 147.645 215.755 151.959 216.523 160.081C229.373 169.943 236.848 168.914 250.474 159.896C249.471 165.268 250.709 167.668 235.874 177.743C220.404 177.355 211.823 179.665 196.758 190.064C194.538 198.149 195.017 201.733 201.861 204.831C218.287 204.663 227.54 201.265 244.168 185.313C242.098 199.7 237.592 206.925 225.449 218.778C211.325 228.443 203.593 230.304 190.362 222.981C176.767 238.205 168.994 228.758 163.611 235.635C163.611 235.635 156.858 242.108 163.81 249.297C170.763 256.485 203.704 249.058 217.217 240.752C219.497 242.325 193.106 273.759 178.458 279.516C163.811 285.273 150.099 272.809 132.981 278.448C126.031 281.653 125.518 284.762 129.659 292.266Z" fill="#EFA63D" stroke="#5E5E5E" stroke-opacity="0.7"/><path id="YellowFlame" d="M70.6972 244.562C73.9278 257.533 76.5265 264.24 84.6267 273.714C87.8157 276.887 90.2401 278.294 95.8008 280.077C98.6341 281.422 100.961 282.135 108.261 283.23C116.16 286.857 119.624 286.218 125.165 283.316C119.425 278.927 127.009 273.493 122.358 271.987C117.706 270.481 124.773 261.925 132.881 264.058C134.455 269.366 136.62 270.936 141.847 272.241C146.765 273.212 150.217 272.978 157.828 270.936C166.713 266.432 169.022 262.045 173.106 254.196C167.019 259.498 163.774 261.117 158.477 260.022C152.865 258.867 150.805 257.208 151.993 249.72C154.99 245.402 157.853 246.301 164.063 244.298C170.273 242.295 182.289 233.622 190.593 223.033C193.989 217.95 193.55 216.131 192.711 212.911C187.908 219.547 184.684 221.91 178.016 223.609C171.617 225.086 169.156 224.086 166.647 219.26C160.269 214.621 187.723 203.401 191.814 199.489C195.904 195.577 196.977 188.19 201.259 186.74C205.54 185.291 204.441 174.851 204.441 174.851C199.635 181.615 196.541 184.388 190.098 186.965C185.076 189.669 183.369 188.678 181.393 184.499C180.038 182.362 180.673 180.957 184.537 178.053C192.026 171.851 196.502 169.278 202.544 158.324C204.954 151.355 206.526 143.52 214.574 133.14C208.141 134.512 204.537 136.533 198.112 142.773C194.082 146.886 191.983 150.187 188.472 157.536C184.248 164.473 181.431 166.166 175.662 165.57C171.426 161.88 170.904 158.466 175.453 148.393L166.099 156.841C162.323 164.037 162.194 166.789 163.02 171.018C159.084 178.673 156.43 180.451 151.132 180.442C144.005 172.722 144.235 167.826 149.273 158.471C145.857 159.442 144.233 158.786 138.581 168.986C139.733 178.969 138.739 184.657 132.891 195.026C127.791 196.947 125.445 196.852 123.043 192.612C122.194 181.978 123.853 175.789 133.202 164.076C124.017 166.279 119.607 169.627 112.648 178.193C107.219 187.909 106.466 193.021 111.973 201.139C102.919 210.847 109.482 215.307 105.348 219.202C105.348 219.202 101.554 223.958 96.4997 219.893C91.4453 215.828 94.3294 194.076 98.9147 184.837C97.7644 183.457 78.971 202.414 76.1007 212.234C73.2304 222.053 82.0907 230.173 79.4412 241.584C77.7729 246.271 75.7922 246.79 70.6972 244.562Z" fill="#FBE055" stroke="#5E5E5E" stroke-opacity="0.7"/></g><path id="BladeBase" d="M315.786 72.8438C316.356 72.2934 316.762 71.5907 316.958 70.8217L324.77 39.8229C325.121 38.405 324.723 36.9067 323.714 35.8523C322.705 34.7978 321.218 34.3393 319.789 34.6394L288.5 41.1831C287.721 41.3473 287.005 41.7243 286.435 42.2746L68.6356 255.647C66.948 257.271 66.8937 259.952 68.5141 261.643L91.995 286.098C92.7734 286.908 93.8444 287.377 94.9673 287.4C96.0907 287.422 97.1766 286.997 97.9871 286.219L153.644 232.774L315.786 72.8438Z" fill="#D9CCCC"/><path id="BladeEdge" opacity="0.2" d="M323.444 36.0085C322.434 34.9541 320.948 34.4956 319.519 34.7957L303.875 38.0675L288.23 41.3393C287.451 41.5036 286.735 41.8805 286.165 42.4308L68.6356 255.647C66.948 257.271 66.8936 259.952 68.5141 261.643L91.995 286.098C92.7733 286.908 93.8443 287.377 94.9673 287.4C96.0906 287.422 97.1765 286.997 97.9871 286.219L315.517 73C316.087 72.4496 316.492 71.7469 316.688 70.978L324.5 39.9792C324.851 38.5608 324.453 37.0626 323.444 36.0085ZM320.385 38.9425L312.58 69.9414L95.0532 283.161L71.5695 258.705L289.096 45.4893L320.385 38.9425Z" fill="white"/><path id="BladeFuller" d="M80.2529 273.87C78.6324 272.179 78.6867 269.498 80.3743 267.874L196.511 154.854C198.201 153.233 200.883 153.288 202.5 154.975C204.124 156.663 204.069 159.347 202.379 160.968L86.2454 273.991C84.5579 275.609 81.8766 275.555 80.2529 273.87Z" fill="#BCAAAA"/><g id="Hilt"><g id="HandleDeco"><path id="Handle" d="M84.2492 285.94C84.272 284.817 83.847 283.728 83.0686 282.918L71.3268 270.69C69.7063 269 67.0219 268.945 65.3343 270.568L26.4448 307.917C24.7573 309.534 24.703 312.216 26.3234 313.906L38.0653 326.134C39.6859 327.818 42.3699 327.872 44.0574 326.255L82.9469 288.907C83.7578 288.129 84.2265 287.064 84.2492 285.94Z" fill="#ED5564"/><path id="Stripe1" d="M42.6711 292.332L78.6222 293.06L82.9473 288.907C83.7578 288.128 84.2265 287.064 84.2492 285.94C84.2579 285.512 84.2012 285.095 84.0881 284.695L51.3175 284.031L42.6711 292.332Z" fill="#DA4453"/><path id="Stripe2" d="M68.9309 302.37L32.9766 301.641L26.4448 307.917C25.8434 308.494 25.453 309.207 25.2673 309.961L60.2845 310.67L68.9309 302.37Z" fill="#DA4453"/></g><path id="CrossGuard" d="M112.785 295.509L59.9487 240.489C58.3282 238.801 55.6469 238.747 53.9594 240.367L44.7874 249.172C43.0997 250.796 43.0454 253.477 44.666 255.161L97.5017 310.183C98.28 310.993 99.3478 311.462 100.471 311.485C101.598 311.508 102.684 311.082 103.494 310.304L112.663 301.499C114.351 299.881 114.405 297.194 112.785 295.509Z" fill="#FFCE54"/><path id="Pommel" d="M45.2373 324.112C45.329 319.587 43.6524 315.295 40.518 312.027C34.0421 305.283 23.2925 305.065 16.5487 311.541C13.2842 314.679 11.4355 318.901 11.3438 323.425C11.2522 327.95 12.9288 332.243 16.0631 335.511C19.2007 338.778 23.4196 340.627 27.9472 340.719C32.4747 340.81 36.7651 339.134 40.0324 335.996C43.2969 332.859 45.1457 328.636 45.2373 324.112Z" fill="#FFCE54"/><path id="HiltDetail" d="M28.2047 328.006C30.5442 328.053 32.4791 326.194 32.5266 323.853C32.574 321.512 30.7159 319.575 28.3765 319.528C26.037 319.481 24.102 321.34 24.0546 323.681C24.0072 326.022 25.8652 327.958 28.2047 328.006Z" fill="#F6BB42"/></g></g><defs><clipPath id="clip0_1_3"><rect width="350" height="350" fill="white"/></clipPath></defs></svg>';        
        string[3] memory parts;
        
        console.logInt(value_pct_change);

        parts[
            0
        ] = sword1;
        if (value_pct_change > 10) {
            parts[
                0
            ] = sword2;
        }
        if (value_pct_change > 40) {
            parts[
                0
            ] = sword3;
        }
        if (value_pct_change > 70) {
            parts[
                0
            ] = sword4;
        }                
        parts[1] = '';
        parts[2] = '';
        string memory generatedSVG = string(
            abi.encodePacked(parts[0], parts[1], parts[2])
        );
        return generatedSVG;
    }
}

contract Nft is ERC721, Ownable {
    uint256 public tokenCounter;
    using SwordMaker for string;
    
    AggregatorV3Interface internal priceFeed;
    mapping(uint256 => int256) public tokenIdToValue;

    constructor(address _priceFeedAddress) ERC721("Price NFT", "PNFT") {
        priceFeed = AggregatorV3Interface(_priceFeedAddress);
    }

    function create() public {
        (, int256 creationValue, , , ) = priceFeed.latestRoundData();
        console.log("creationValue = ");
        console.logInt(creationValue);
        tokenIdToValue[tokenCounter] = creationValue;
        _safeMint(msg.sender, tokenCounter);
        tokenCounter = tokenCounter + 1;
    }

    function tokenURI(uint256 tokenId)
        public
        view
        virtual
        override
        returns (string memory)
    {
        require(
            _exists(tokenId),
            "ERC721Metadata: URI query for nonexistent token"
        );

        // generate SVG from price
        (, int256 currentValue, , , ) = priceFeed.latestRoundData();
        console.log("currentValue = ");
        console.logInt(currentValue);
        int256 creationValue = tokenIdToValue[tokenId];
        int256 value_pct_change = ((currentValue - creationValue) / creationValue)*100;

        // ****** call_Library_to_get generatedSVG
        string memory generatedSVG = SwordMaker.generateSVGFromPrice(value_pct_change);

        // SVG to ImageURI
        string memory imageURI = svgToImageURI(generatedSVG);
        // Format TokenURI
        return formatTokenURI(imageURI);
    }

    function svgToImageURI(string memory svg)
        public
        pure
        returns (string memory)
    {
        string memory baseURL = "data:image/svg+xml;base64,";
        string memory svgBase64Encoded = Base64.encode(bytes(svg));
        return string(abi.encodePacked(baseURL, svgBase64Encoded));
    }

    function formatTokenURI(string memory imageURI)
        public
        pure
        returns (string memory)
    {
        return
            string(
                abi.encodePacked(
                    "data:application/json;base64,",
                    Base64.encode(
                        bytes(
                            abi.encodePacked(
                                '{"name":"',
                                "Price Feed NFT",
                                '", "description":"", "attributes":"", "image":"',
                                imageURI,
                                '"}'
                            )
                        )
                    )
                )
            );
    }

    function toString(uint256 value) internal pure returns (string memory) {
        // Inspired by OraclizeAPI's implementation - MIT license
        // https://github.com/oraclize/ethereum-api/blob/b42146b063c7d6ee1358846c198246239e9360e8/oraclizeAPI_0.4.25.sol

        if (value == 0) {
            return "0";
        }
        uint256 temp = value;
        uint256 digits;
        while (temp != 0) {
            digits++;
            temp /= 10;
        }
        bytes memory buffer = new bytes(digits);
        while (value != 0) {
            digits -= 1;
            buffer[digits] = bytes1(uint8(48 + uint256(value % 10)));
            value /= 10;
        }
        return string(buffer);
    }
}